\documentclass[10pt]{article}
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{geometry}
%\usepackage[mathcal]{euscript}
\geometry{ top=2.5cm, bottom=2cm, left=2cm, right=2cm}
\usepackage[authoryear]{natbib}
\usepackage{pdflscape}
%\geometry{papersize={216mm,330mm}, top=3cm, bottom=2.5cm, left=4cm,  right=2cm}

\newcommand{\D}{\partial}
\newcommand{\Diff}[2] {\dfrac{\partial( #1)}{\partial #2}}
\newcommand{\diff}[2] {\dfrac{\partial #1}{\partial #2}}
\newcommand{\bv}[1]{\ensuremath{\mbox{\boldmath$ #1 $}}}
\newcommand{\gv}[1]{\ensuremath{\mbox{\boldmath$ #1 $}}}% for vectors of Greek letters
\newcommand{\grad}[1]{\gv{\nabla} #1}
\newcommand{\Rho}{\,\mathtt{Rho}}
\newcommand{\PP}{\,\mathtt{P}}
\newcommand{\U}{\,\mathtt{U}}
\newcommand{\V}{\,\mathtt{V}}
\newcommand{\W}{\,\mathtt{W}}
\newcommand{\Lo}{\,\mathcal{L}}
\newcommand{\MU}{\,\mathtt{Mu}}
\newcommand{\Mu}{\,\mathtt{Mu}}
\newcommand{\T}{\,\mathtt{T}\,}
\newcommand{\DMuDx}{\diff{\Mu}{x}}
\newcommand{\DMuDy}{\diff{\Mu}{y}}
\newcommand{\DMuDz}{\diff{\Mu}{z}}
\newcommand{\kk}{\,\mathtt{k}}
\newcommand{\timee}{\,\text{time}}
\newcommand{\convection}{\,\text{convection}}
\newcommand{\conduction}{\,\text{conduction}}
\newcommand{\workpressure}{\,\text{pressure work}}
\newcommand{\workviscous}{\,\text{viscous work}}
\newcommand{\viscous}{\,\text{viscous}}
\newcommand{\pressure}{\,\text{pressure}}

\newcommand{\production}{\text{production}}
\newcommand{\diffusion}{\text{diffusion}}


\usepackage{color}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\usepackage{listings} % to include codes using \lstinputlisting
\lstset{ %
language=sh,                      % choose the language of the code
basicstyle=\footnotesize\ttfamily,       % the size of the fonts that are used for the code
%stringstyle=\ttfamily,
%commentstyle=\scriptsize\sffamily,
%keywordstyle=\bfseries,        % so funciona com basicstyle=\footnotesize,\ttfamily se eu adicionar \usepackage{bold-extra}
keywordstyle=\color{blue},          % keyword style
commentstyle=\color{dkgreen}\sffamily,       % comment style
stringstyle=\color{mauve},  
identifierstyle=\bfseries,
numberbychapter= true,
numberfirstline=false,
% numbers=left,                   % where to put the line-numbers
numberstyle=\footnotesize,      % the size of the fonts that are used for the line-numbers
stepnumber=5,                   % the step between two line-numbers. If it is 1 each line will be numbered
numbersep=8pt,                  % how far the line-numbers are from the code
%backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
showspaces=false,               % show spaces adding particular underscores
showstringspaces=false,         % underline spaces within strings
showtabs=false,                 % show tabs within strings adding particular underscores
%frameround=fttt,                 % roundish frame - Kemelli
%frame=trBL,          			% single % adds a frame around the code
% frameshape={RYRYYY}{yn}{ny}{RYRYYY},
frameshape={YYYYYY}{yn}{ny}{YYYYYY},
% frameshape={RYRYYY}{ny}{yn}{RYRYYY},
%frame=shadowbox, rulesepcolor=\color{black},
tabsize=2,         				% sets default tabsize to 2 spaces
captionpos=b,           		% sets the caption-position to bottom
breaklines=true,       			% sets automatic line breaking
breakatwhitespace=false,    % sets if automatic breaks should only happen at whitespace
escapeinside={\%*}{*)},         % if you want to add a comment within your code
morekeywords ={rm,ls},
belowskip = 10pt, %\medskipamount%\smallskipamount,
aboveskip =10pt,
}  
%opening
\title{Manufactured Solution for the 2D Compressible Transient Navier--Stokes Equations with Sutherland Viscosity Model using Maple\texttrademark}
\author{Kemelli C. Estacio-Hiroms}

\begin{document}

\maketitle

\begin{abstract}
The Method of Manufactured Solutions is a valuable approach for code verification, providing means to verify how accurately the numerical method solves the partial differential equations of interest.
This document presents the source terms generated by the application of the Method of Manufactured Solutions (MMS) on the 2D transient Navier--Stokes equations  with Sutherland Viscosity Model using the analytical manufactured solutions for density, velocity and pressure presented by \citet{Roy2002}.
\end{abstract}





\section{Mathematical Model}
The conservation of mass, momentum, and total energy for a compressible transient viscous fluid may be written as:
\begin{equation}
 \label{eq:ns_01}
\Diff{\rho}{t} +\nabla \cdot \left(\rho \bv{u}\right) = 0,
\end{equation}

\begin{equation}
 \label{eq:ns_02}
\Diff{\rho \bv{u}}{t} +\nabla\cdot\left(\rho\bv{u}\bv{u}\right) = -\nabla p+  \nabla \cdot (\bv{\tau} ),
\end{equation}

\begin{equation}
 \label{eq:ns_03}
%\nabla \cdot (\rho\bv{u}e_t)+  \nabla\cdot(p  \bv{u})=0
\Diff{\rho e_t}{t} +\nabla\cdot\left(\rho \bv{u} H\right) =-   \nabla\cdot(p  \mathbf{u}) -\nabla\cdot \mathbf{q} +  \nabla \cdot (\bv{\tau} \cdot \mathbf{u}).
\end{equation}


Equations (\ref{eq:ns_01})--(\ref{eq:ns_03}) are known as Navier--Stokes equations and, $\rho$ is the density, $\bv{u}=(u,v)$ is the velocity in $x$ or $y$-direction, respectively,    and $p$ is the pressure. The total enthalpy, $H$, may be expressed in terms of the total energy per unit mass $e_t$, density, and pressure:
$$H = e_t + \dfrac{p}{\rho}.$$

For a calorically perfect gas, the Navier--Stokes equations are closed with two auxiliary relations for energy:
\begin{equation}
 \label{eq:ns_04}
e_t= e+\dfrac{\bv{u}\cdot \bv{u}}{2},\quad\mbox{and}\quad e=\dfrac{1}{\gamma -1}RT ,
\end{equation}
and with the ideal gas equation of state:
\begin{equation}
 \label{eq:ns_05}
p=\rho RT.
\end{equation}

The shear stress tensor is:
\begin{equation}
  \tau_{xx}= \dfrac{2}{3}  \mu \left( 2 \diff{u}{x} - \diff{v}{y} \right),\quad
  \tau_{xy}= \tau_{yx}=\mu \left( \diff{u}{y} + \diff{v}{x}\right),\quad
  \tau_{yy}= \dfrac{2}{3}  \mu \left( 2 \diff{v}{y} - \diff{u}{x}  \right),
\end{equation}
where $\mu$ is the absolute viscosity. The heat flux vector $\mathbf{q}=(q_x,q_y)$ is given by:
\begin{equation}
 %\begin{split}
 % q_x &= - k \diff{T}{x}\\
%q_y &= - k \diff{T}{y}
% \end{split}
 q_x = - \kappa \diff{T}{x}, \quad q_y = - \kappa \diff{T}{y}
 \end{equation}
where $\kappa$ is the thermal conductivity, which can be determined by choosing the Prandtl number:
\begin{equation}
 \label{eq:k}
\kappa = \dfrac{\gamma R \mu}{ (\gamma-1) \text{Pr}}.
\end{equation}



\subsection{Sutherland viscosity model}

\citet{Sutherland1893} published a relationship between the absolute temperature of an ideal gas, $T$,  and its dynamic (absolute) viscosity, $\mu$. The model is based on the kinetic theory of ideal gases and an idealized intermolecular-force potential. The general equation is given as:
\begin{equation}
\label{eq:Sutherland01}
 \mu  =\dfrac{A_\mu \, T^{\frac{3}{2}}}{T+B_\mu}
\end{equation}
with
\begin{equation}
\label{eq:Sutherland02}
A_\mu = \dfrac{\mu_\text{ref}}{T_{\text{ref}}^{\frac{3}{2}}}(T_\text{ref} + B_\mu),
\end{equation}
%
where $B_\mu$ is the Sutherland temperature, $T_{\text{ref}}$ is a reference temperature,  and $\mu_\text{ref}$ is the viscosity at the reference temperature $T_\text{ref}$.


\section{Manufactured Solution}

The Method of Manufactured Solutions (MMS) applied to Navier--Stokes equations consists in modifying Equations~(\ref{eq:ns_01})~--~(\ref{eq:ns_03}) by adding a source term to the right-hand side of each equation, so the modified set of equations conveniently has the analytical solution chosen \textit{a priori}.

\citet{Roy2002} introduce the general form of the primitive manufactured solution variables to be  a function of sines and cosines in $x$, $y$ and $z$ only. In this work, \citet{Roy2002}'s manufactured solutions are modified in order to address temporal accuracy as well:
\begin{equation}
 \label{eq:manufactured01}
  \phi (x,y,t) = \phi_0+ \phi_x\, f_s \left(\frac{a_{\phi x} \pi x}{L} \right) +  \phi_y \,f_s\left(\frac{a_{\phi y} \pi y}{L}\right) +  \phi_t \,f_s\left(\frac{a_{\phi t} \pi t}{L}\right),
\end{equation}
where $\phi=\rho,u,v$ or $p$, and $f_s(\cdot)$ functions denote either sine or cosine function. Note that in this case, $\phi_x$, $\phi_y$,  and $\phi_t$ are constants  and the subscripts do not denote differentiation.



Although \citet{Roy2002} provide the constants used in the manufactured solutions for the 2D supersonic and subsonic cases for Euler and Navier-Stokes equations, only the source term for the 2D mass conservation equation~(\ref{eq:ns_01}) is presented.


Source terms  for mass conservation ($Q_\rho$), momentum ($Q_u$, $Q_v$)  and total energy ($Q_{e_t}$) equations are obtained by symbolic manipulations of compressible transient Navier--Stokes equations above using Maple~15~\citep{Maple15} and are presented in the following sections for the one, two and three-dimensional cases.


The manufactured analytical solution for each one of the variables in the 2D transient Navier--Stokes equations are:
\begin{equation}
\begin{split}
\label{eq:manufactured_3d} 
\rho\left( x ,y ,t\right) &=  \rho_{0}+ \rho_{x} \sin\left(\frac{a_{ \rho  x} \pi x}{L}\right)+ \rho_{y} \cos\left(\frac{a_{ \rho  y} \pi y}{L}\right)  + \rho_t \sin\left(\dfrac{a_{\rho t} \pi t}{L_t}\right),\\
%
u\left( x ,y ,t\right) &= u_{0}+u_{x} \sin\left(\frac{a_{u  x} \pi x}{L}\right)+u_{y} \cos\left(\frac{a_{u  y} \pi y}{L}\right) + u_t \cos\left(\dfrac{a_{u t} \pi t}{L_t}\right),\\
%
v\left( x ,y ,t\right) &= v_{0}+v_{x} \cos\left(\frac{a_{v  x} \pi x}{L}\right)+v_{y} \sin\left(\frac{a_{v  y} \pi y}{L}\right)+ v_t \sin\left(\dfrac{a_{v t} \pi t}{L_t}\right), \\
%
p\left( x ,y ,t\right) &= p_{0}+p_{x} \cos\left(\frac{a_{p  x} \pi x}{L}\right)+p_{y} \sin\left(\frac{a_{p  y} \pi y}{L}\right)+ p_t \cos\left(\dfrac{a_{p t} \pi t}{L_t}\right).
\end{split}
\end{equation}


The MMS applied to 2D Navier--Stokes equations  with Sutherland viscosity model consists in modifying Equations~(\ref{eq:ns_01})--(\ref{eq:ns_03}) by adding a source term to the right-hand side of each equation:
\begin{equation}
\begin{split}
\label{eq:ns_2d_mod}
&\Diff{\rho}{t} +\Diff{\rho u}{x}+\Diff{\rho v}{y} = Q_\rho\\
%
 &\Diff{\rho u}{t} +\Diff{\rho u^2 }{x}+\Diff{\rho uv}{y}  +\Diff{p}{x}-\Diff{\tau_{xx}}{x}-\Diff{\tau_{xy}}{y}= Q_u,\\
% %
&\Diff{\rho v}{t} +\Diff{\rho uv}{x}+\Diff{\rho v^2}{y} +\Diff{p}{y}-\Diff{\tau_{yx}}{x}-\Diff{\tau_{yy}}{y}= Q_v,\\
% %
 &\Diff{\rho e_t}{t} +\Diff{\rho u e_t}{x}+\Diff{\rho v e_t}{y}+\Diff{pu}{x}+\Diff{pv}{y}+\Diff{q_x}{x} +\Diff{q_y}{y} -\Diff{u\tau_{xx}+v\tau_{xy}}{x}-\Diff{u\tau_{yx}+v\tau_{yy}}{y}=Q_{e_t},
\end{split}
\end{equation}
so this modified set of equations has for analytical solution Equation (\ref{eq:manufactured_3d}).

The source terms $Q_\rho$, $Q_u$, $Q_v$ and $Q_{e_t}$ are  presented with the use of the following auxiliary variables:\begin{equation}
 \begin{split}
\label{eq:aux_01}
\Rho \, &= \rho_{0}+ \rho_{x} \sin\left(\frac{a_{ \rho  x} \pi x}{L}\right)+ \rho_{y} \cos\left(\frac{a_{ \rho  y} \pi y}{L}\right) +  \rho_t \sin\left(\dfrac{a_{\rho t} \pi t}{L}\right),\\
%
\U&=u_{0}+u_{x} \sin\left(\frac{a_{u  x} \pi x}{L}\right)+u_{y} \cos\left(\frac{a_{u  y} \pi y}{L}\right)+ u_t \cos\left(\dfrac{a_{u t} \pi t}{L}\right) ,\\
%
\V \, &= v_{0}+v_{x} \cos\left(\frac{a_{v  x} \pi x}{L}\right)+v_{y} \sin\left(\frac{a_{v  y} \pi y}{L}\right)+ v_t \sin\left(\dfrac{a_{v t} \pi t}{L}\right), \\
%
\PP \, &= p_{0}+p_{x} \cos\left(\frac{a_{p  x} \pi x}{L}\right)+p_{y} \sin\left(\frac{a_{p  y} \pi y}{L}\right)+ p_t \cos\left(\dfrac{a_{p t} \pi t}{L}\right),\\
\T&= \dfrac{\PP}{R\Rho},\\
\Mu  &=\dfrac{A_\mu \, \T^{\frac{3}{2}}}{\T+B_\mu},\\
\end{split}
\end{equation}
which simply are the manufactured solutions for $\rho, u, v$ and $p$, the temperature (\ref{eq:ns_05}), and  the fluid viscosity according to Sutherland model (\ref{eq:Sutherland01}), respectively. The following expressions for the derivatives of the viscosity are also used:
\begin{equation}
\begin{split}\label{eq:aux_02}
\DMuDx &= \dfrac{a_{\rho x} \pi \rho_x \Mu^2 }{A_{\mu} L \Rho \sqrt{\T}}\cos\left(\dfrac{a_{\rho x} \pi x}{L}\right)-\dfrac{3}{2} \dfrac{a_{\rho x} \pi \rho_x \Mu }{L \Rho}\cos\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \\ 
&\quad+\dfrac{a_{px} \pi p_x \Mu^2 }{A_{\mu} L R \Rho \T^{3/2}}\sin\left(\dfrac{a_{px} \pi x}{L}\right)-\dfrac{3}{2} \dfrac{a_{px} \pi p_x \Mu }{L R \Rho \T}\sin\left(\dfrac{a_{px} \pi x}{L}\right)\\ \vspace{15pt}
%
\DMuDy &= -\dfrac{a_{\rho y} \pi \rho_y \Mu^2 }{A_{\mu} L \Rho \sqrt{\T}}\sin\left(\dfrac{a_{\rho y} \pi y}{L}\right)+\dfrac{3}{2} \dfrac{a_{\rho y} \pi \rho_y \Mu }{L \Rho}\sin\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \\ 
&\quad-\dfrac{a_{py} \pi p_y \Mu^2 }{A_{\mu} L R \Rho \T^{3/2}}\cos\left(\dfrac{a_{py} \pi y}{L}\right)+\dfrac{3}{2} \dfrac{a_{py} \pi p_y \Mu }{L R \Rho \T}\cos\left(\dfrac{a_{py} \pi y}{L}\right).
\end{split}
\end{equation}

\subsection{2D Mass Conservation}
The mass conservation equation may be written as an operator $\Lo_\rho$:
$$ \Lo_{\rho} = \Lo_{\rho \, \text{time}}+\Lo_{\rho \, \text{convection}}$$
where:
\begin{equation}
\begin{split}\label{eq:rho_operators}
\Lo_{\rho \, \text{time}}&=\Diff{\rho}{t} \\
\Lo_{\rho \, \text{convection}}&=\Diff{\rho u}{x}+\Diff{\rho v}{y} .
\end{split}
 \end{equation}

The operators defined in Eq. (\ref{eq:rho_operators}) are applied into Equation  (\ref{eq:manufactured_3d}), providing respective source terms that will compound source term $Q_{\rho}$:
\begin{equation*}
 Q_{\rho} = Q_{\rho \, \text{time}}+Q_{\rho \, \text{convection}}.
\end{equation*}


They are:

\begin{equation*}
\begin{split}
 Q_{\rho \convection} &= \cos\left(\dfrac{a_{\rho x} \pi x}{L}\right) \dfrac{a_{\rho x} \pi \rho_x \U}{L}-\sin\left(\dfrac{a_{\rho y} \pi y}{L}\right) \dfrac{a_{\rho y} \pi \rho_y \V}{L}+\\
	&\quad+\dfrac{\pi \Rho}{L} \left(a_{ux} u_x \cos\left(\dfrac{a_{ux} \pi x}{L}\right)+a_{vy} v_y \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\right) \\ \vspace{15pt}
%
Q_{\rho \timee} &= \dfrac{a_{\rho t} \pi \rho_t }{L_t} \cos\left(\dfrac{a_{\rho t} \pi t}{L_t}\right) ,
\end{split}
\end{equation*}
where $\Rho,\,\U,\,\V$ and $\W$  are defined in Equation (\ref{eq:aux_01}).


\subsection{2D Momentum}


% Velocity u -----------------------------------------------------------------------------
\subsubsection{Velocity $u$}
For the generation of the analytical source term $Q_u$, $x$-momentum equation (\ref{eq:ns_02}) is written as an operator $\Lo_u$:
 $$\Lo_u = \Lo_{u \, \text{time}}+\Lo_{u \, \convection}+\Lo_{u \, \pressure }+\Lo_{u \, \viscous }$$
with each one of the sub-operators defined as follows:
\begin{equation*}
 \begin{split}
\Lo_{u \, \text{time}}&= \Diff{\rho u}{t} \\
\Lo_{u \, \convection}&= \Diff{\rho u^2 }{x}+\Diff{\rho uv}{y} \\
\Lo_{u \, \pressure }&= \Diff{p}{x}\\
\Lo_{u \, \viscous }&= -\Diff{\tau_{xx}}{x}-\Diff{\tau_{xy}}{y}
 \end{split}
\end{equation*}

Source term $Q_u$ is obtained by operating $\Lo_{u}$ on Equations  (\ref{eq:manufactured_3d}) together with the use of the  auxiliary relations given in Equations (\ref{eq:aux_01}) and (\ref{eq:aux_02}). It yields:
\begin{equation*}
Q_u = Q_{u \, \text{time}}+Q_{u \, \convection}+Q_{u \, \pressure }+Q_{u \, \viscous }
\end{equation*}
with
\begin{equation*}
\begin{split}
 Q_{u \convection} &= \dfrac{a_{\rho x} \pi \rho_x \U^2}{L} \cos\left(\dfrac{a_{\rho x} \pi x}{L}\right)-\dfrac{a_{\rho y} \pi \rho_y \U \V }{L}\sin\left(\dfrac{a_{\rho y} \pi y}{L}\right)-\dfrac{a_{uy} \pi u_y \Rho \V}{L} \sin\left(\dfrac{a_{uy} \pi y}{L}\right) +\\
	&\quad+\dfrac{\pi \Rho \U}{L}\left(2 a_{ux} u_x \cos\left(\dfrac{a_{ux} \pi x}{L}\right)+a_{vy} v_y \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\right)  \\ \vspace{15pt}
%
Q_{u \pressure} &= -a_{px} \pi p_x \sin\left(\dfrac{a_{px} \pi x}{L}\right)/L \\ \vspace{15pt}
%
Q_{u \viscous} &= \dfrac{1}{3} \dfrac{ \Mu \pi^2}{L^2} \left(4 a_{ux}^2 u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right)+3 a_{uy}^2 u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right)\right)+\\
	&\quad-\dfrac{2}{3}\DMuDx \dfrac{\pi}{L} \left(2 a_{ux} u_x \cos\left(\dfrac{a_{ux} \pi x}{L}\right)-a_{vy} v_y \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\right)  +\\
	&\quad+\DMuDy \dfrac{\pi}{L}\left(a_{uy} u_y \sin\left(\dfrac{a_{uy} \pi y}{L}\right)+a_{vx} v_x \sin\left(\dfrac{a_{vx} \pi x}{L}\right)\right)   \\ \vspace{15pt}
%
Q_{u \timee} &= -\dfrac{a_{ut} u_t \pi \Rho}{L_t}\sin\left(\dfrac{a_{ut} t \pi}{L_t}\right) +\dfrac{a_{\rho t} \rho_t \pi \U}{L_t}\cos\left(\dfrac{a_{\rho t} t \pi}{L_t}\right),
\end{split}
\end{equation*}
%
with $\Mu,\, \Rho,\,\U,$ and $\V$  defined in Equation (\ref{eq:aux_01}) and the derivatives $\DMuDx$ and $\DMuDy$  defined in Equation~(\ref{eq:aux_02}).



% Velocity v -----------------------------------------------------------------------------
\subsubsection{Velocity $v$}
Analogously to the velocity-$u$ case, for the generation of the analytical source term $Q_v$, $y$-momentum equation (\ref{eq:ns_02}) is written as an operator $\Lo_v$:
 $$\Lo_v = \Lo_{v \, \text{time}}+\Lo_{v \, \convection}+\Lo_{v \, \pressure }+\Lo_{v \, \viscous }$$
with each one of the sub-operators defined as follows:
\begin{equation*}
 \begin{split}
\Lo_{v \, \text{time}}&= \Diff{\rho v}{t} \\
\Lo_{v \, \convection}&= \Diff{\rho uv }{x}+\Diff{\rho v^2}{y}\\
\Lo_{v \, \pressure }&= \Diff{p}{y}\\
\Lo_{v \, \viscous }&= -\Diff{\tau_{yx}}{x}-\Diff{\tau_{yy}}{y}
 \end{split}
\end{equation*}

Source term $Q_v$ is obtained by operating $\Lo_{v}$ on Equations  (\ref{eq:manufactured_3d}) together with the use of the  auxiliary relations given in Equations (\ref{eq:aux_01}) and (\ref{eq:aux_02}). It yields:
\begin{equation*}
Q_v = Q_{v \, \text{time}}+Q_{v \, \convection}+Q_{v \, \pressure }+Q_{v \, \viscous }
\end{equation*}
with
\begin{equation*}
\begin{split}
 Q_{v \convection} &= \dfrac{a_{\rho x} \pi \rho_x \U \V }{L} \cos\left(\dfrac{a_{\rho x} \pi x}{L}\right)
-\dfrac{a_{\rho y} \pi \rho_y \V^2 }{L} \sin\left(\dfrac{a_{\rho y} \pi y}{L}\right)
-\dfrac{a_{vx} \pi v_x \Rho \U }{L} \sin\left(\dfrac{a_{vx} \pi x}{L}\right) +\\
	&\quad+\dfrac{\pi \Rho \V}{L}\left(a_{ux} u_x \cos\left(\dfrac{a_{ux} \pi x}{L}\right)+2 a_{vy} v_y \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\right)   \\ \vspace{15pt}
%
Q_{v \pressure} &= \dfrac{a_{py} \pi p_y }{L}\cos\left(\dfrac{a_{py} \pi y}{L}\right) \\ \vspace{15pt}
%
Q_{v \viscous} &= \dfrac{1}{3} \dfrac{\Mu \pi^2}{L^2} \left(3 a_{vx}^2 v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right)+4  a_{vy}^2 v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right)\right)  +\\
	&\quad+ \DMuDx \dfrac{\pi}{L}\left(a_{uy} u_y \sin\left(\dfrac{a_{uy} \pi y}{L}\right)+a_{vx} v_x \sin\left(\dfrac{a_{vx} \pi x}{L}\right)\right)  +\\
	&\quad -\dfrac{2}{3} \DMuDy \dfrac{\pi}{L}\left(-a_{ux} u_x \cos\left(\dfrac{a_{ux} \pi x}{L}\right)+2 a_{vy} v_y \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\right)   \\ \vspace{15pt}
%
Q_{v \timee} &= \dfrac{a_{vt} v_t \pi \Rho }{L_t}\cos\left(\dfrac{a_{vt} \pi t}{L_t}\right)  +\dfrac{a_{\rho t} \rho_t \pi \V }{L_t}\cos\left(\dfrac{a_{\rho t} \pi t}{L_t}\right) ,
\end{split}
\end{equation*}
%
where $\Mu,\, \Rho,\,\U$ and $\V$  are defined in Equation (\ref{eq:aux_01}) and the derivatives $\DMuDx$ and $\DMuDy$ are given in Equation~(\ref{eq:aux_02}).


\subsection{Total Energy Conservation Equation}
The total energy equation is written as an operator:
\begin{equation*}
 \label{eq:ns1d_14}
\Lo_{e_t} = \Lo_{e_t \text{time}} + \Lo_{e_t \convection} + \Lo_{e_t \workpressure}+ \Lo_{e_t \workviscous} + \Lo_{e_t \conduction} 
\end{equation*}
with
\begin{equation*}
\begin{split}
\Lo_{e_t \text{time}}&= \Diff{\rho e_t}{t} ,\\
\Lo_{e_t \convection} &= \Diff{\rho u e_t}{x}+\Diff{\rho v e_t}{y},\\
\Lo_{e_t \workpressure} &=+\Diff{pu}{x}+\Diff{pv}{y} ,\\
\Lo_{e_t \conduction} &=+\Diff{q_x}{x} +\Diff{q_y}{y},\\ 
\Lo_{e_t \workviscous} &= -\Diff{u\tau_{xx}+v\tau_{xy}}{x}-\Diff{u\tau_{yx}+v\tau_{yy}}{y},\\
 \end{split}
\end{equation*}

Therefore, source term $Q_{e_t}$ is given by
$$Q_{e_t} = Q_{e_t \text{time}} + Q_{e_t \convection} + Q_{e_t \workpressure}+ Q_{e_t \workviscous} + Q_{e_t \conduction}, $$
where:
\begin{equation*}
\begin{split}
 Q_{e \convection} &= \dfrac{1}{2} \dfrac{a_{\rho x} \pi \rho_x \U^3 }{L} \cos\left(\dfrac{a_{\rho x} \pi x}{L}\right)+ \dfrac{1}{2} \dfrac{a_{\rho x} \pi \rho_x \U \V^2 }{L}\cos\left(\dfrac{a_{\rho x} \pi x}{L}\right)- \dfrac{\dfrac{1}{2} a_{\rho y} \pi \rho_y \U^2 \V}{L} \sin\left(\dfrac{a_{\rho y} \pi y}{L}\right)+\\
	&\quad-\dfrac{1}{2} \dfrac{a_{\rho y} \pi \rho_y \V^3 }{L}\sin\left(\dfrac{a_{\rho y} \pi y}{L}\right)-\dfrac{a_{px} \pi p_x \U }{(\gamma-1) L}\sin\left(\dfrac{a_{px} \pi x}{L}\right) +\dfrac{a_{py} \pi p_y \V }{(\gamma-1) L}\cos\left(\dfrac{a_{py} \pi y}{L}\right) +\\
	&\quad+\dfrac{1}{2} \dfrac{\pi \Rho \U^2}{L} \left(3 a_{ux} u_x \cos\left(\dfrac{a_{ux} \pi x}{L}\right)+a_{vy} v_y \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\right) +\\
	&\quad-\dfrac{\pi \Rho \U \V}{L}\left(a_{uy} u_y \sin\left(\dfrac{a_{uy} \pi y}{L}\right)+a_{vx} v_x \sin\left(\dfrac{a_{vx} \pi x}{L}\right)\right) +\\
	&\quad+\dfrac{1}{2} \dfrac{\pi \Rho \V^2}{L}\left(a_{ux} u_x \cos\left(\dfrac{a_{ux} \pi x}{L}\right)+3 a_{vy} v_y \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\right) +\\
	&\quad+\dfrac{\pi \PP}{(\gamma-1) L}\left(a_{ux} u_x \cos\left(\dfrac{a_{ux} \pi x}{L}\right)+a_{vy} v_y \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\right)  \\ \vspace{15pt}
%
Q_{e \workpressure} &= -\dfrac{a_{px} \pi p_x \U }{L}\sin\left(\dfrac{a_{px} \pi x}{L}\right) +\dfrac{a_{py} \pi p_y \V }{L}\cos\left(\dfrac{a_{py} \pi y}{L}\right)  +\\
	&\quad+ \dfrac{\pi \PP}{L}\left(a_{ux} u_x \cos\left(\dfrac{a_{ux} \pi x}{L}\right)+a_{vy} v_y \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\right) \\ \vspace{15pt}
%
%
Q_{e \conduction} &= \kk \DMuDx \dfrac{a_{\rho x} \pi \rho_x \PP }{L R \Mu \Rho^2}\cos\left(\dfrac{a_{\rho x} \pi x}{L}\right)  +\kk \DMuDx \dfrac{a_{px} \pi p_x }{L R \Mu \Rho}\sin\left(\dfrac{a_{px} \pi x}{L}\right)+\\
	&\quad-\kk \DMuDy \dfrac{a_{\rho y} \pi \rho_y \PP  }{L R \Mu \Rho^2}\sin\left(\dfrac{a_{\rho y} \pi y}{L}\right) -\kk \DMuDy \dfrac{a_{py} \pi p_y}{L R \Mu \Rho}\cos\left(\dfrac{a_{py} \pi y}{L}\right)+\\
	&\quad+\dfrac{\kk \pi^2}{L^2 R \Rho} \left(a_{px}^2 p_x \cos\left(\dfrac{a_{px} \pi x}{L}\right)+a_{py}^2 p_y \sin\left(\dfrac{a_{py} \pi y}{L}\right)\right) +\\
	&\quad-\dfrac{\kk \pi^2 \PP }{L^2 R \Rho^2}\left(a_{\rho x}^2 \rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right)+a_{\rho y}^2 \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right)\right) +\\
	&\quad -\dfrac{2 \kk \pi^2 }{L^2 R \Rho^2} \left( a_{\rho x} a_{px} \rho_x p_x \cos\left(\dfrac{a_{\rho x} \pi x}{L}\right) \sin\left(\dfrac{a_{px} \pi x}{L}\right)+a_{\rho y} a_{py} \rho_y p_y \sin\left(\dfrac{a_{\rho y} \pi y}{L}\right) \cos\left(\dfrac{a_{py} \pi y}{L}\right)\right)  +\\
	&\quad- \dfrac{2\kk \pi^2 \PP }{L^2 R \Rho^3} \left(a_{\rho x}^2 \rho_x^2 \cos\left(\dfrac{a_{\rho x} \pi x}{L}\right)^2+a_{\rho y}^2 \rho_y^2 \sin\left(\dfrac{a_{\rho y} \pi y}{L}\right)^2\right)  \\ \vspace{15pt}
%
Q_{e \timee} &= -\dfrac{a_{ut} u_t \pi \Rho \U }{L_t} \sin\left(\dfrac{a_{ut} \pi t}{L_t}\right) 
+\dfrac{a_{vt} v_t \pi \Rho \V }{L_t} \cos\left(\dfrac{a_{vt} \pi t}{L_t}\right) 
+\dfrac{1}{2} \dfrac{a_{\rho t} \rho_t \pi \U^2 }{L_t} \cos\left(\dfrac{a_{\rho t} \pi t}{L_t}\right) +\\
	&\quad+\dfrac{1}{2} \dfrac{a_{\rho t} \rho_t \pi \V^2 }{L_t} \cos\left(\dfrac{a_{\rho t} \pi t}{L_t}\right)-\dfrac{a_{pt} p_t \pi}{(\gamma-1) L_t}\sin\left(\dfrac{a_{pt} \pi t}{L_t}\right) ,
\end{split}
\end{equation*}

Again, $\Mu,\, \Rho,\,\U,\,\V,$ and $\PP$ are defined in Equation (\ref{eq:aux_01}) and the derivatives $\DMuDx$ and $\DMuDy$ are given in Equation~(\ref{eq:aux_02}).
Accordingly,
$$\texttt{k}=\dfrac{\gamma R \Mu}{(\gamma-1)\text{Pr}}.$$



\section{Boundary Conditions}
Additionally to verifying code capability of solving the governing equations accurately in the interior of the domain of interest, one may also verify the software capability of correctly imposing boundary conditions. Therefore, the gradients of the  analytical solutions (\ref{eq:manufactured01}) have been calculated and translated into $C$ codes. For the 2D case, they are:
\begin{equation*}
\nabla  \rho= \left[ \begin{array}{c}
 \dfrac{  a_{\rho x}  \pi \rho_x}{L} \cos\left( \dfrac{ a_{\rho x}  \pi  x}{L}\right)\vspace{5pt} \\
-\dfrac{  a_{\rho y}  \pi \rho_y}{L} \sin\left( \dfrac{ a_{\rho y}  \pi  y}{L}\right)
 \end{array} \right],
\qquad
\nabla p = \left[ \begin{array}{c}
- \dfrac{  a_{px}  \pi p_x}{L} \sin\left( \dfrac{ a_{px}  \pi  x}{L}\right)\vspace{5pt}\\
  \dfrac{  a_{py}  \pi p_y}{L} \cos\left( \dfrac{ a_{py}  \pi  y}{L}\right)
\end{array} \right],
\end{equation*}
%
\begin{equation*}
\nabla u = \left[ \begin{array}{c}
  \dfrac{  a_{ux}  \pi u_x}{L} \cos\left( \dfrac{ a_{ux}  \pi  x}{L}\right)\vspace{5pt}\\
 -   \dfrac{  a_{uy}  \pi u_y}{L} \sin\left( \dfrac{ a_{uy}  \pi  y}{L}\right)
\end{array} \right],
\qquad
\nabla  v= \left[ \begin{array}{c}
-  \dfrac{  a_{vx}  \pi v_x}{L}  \sin\left( \dfrac{ a_{vx}  \pi  x}{L}\right)\vspace{5pt}\\
    \dfrac{  a_{vy}  \pi v_y}{L} \cos\left( \dfrac{ a_{vy}  \pi  y}{L}\right)
\end{array} \right].
\end{equation*}

\section{Hierarchic MMS}

The complexity, and consequently length, of the source terms increase with both dimension and physics handled by the governing equations. 
Applying commands in order to simplify such extensive expression is challenging even with a very good machine; thus, a suitable alternative to this issue is to simplify the equation by dividing it into a combination of sub-operators handling different physical phenomena. Then, each one of the operators may be applied to the manufactured solutions individually, and the resulting sub-source terms are combined back to represent the source term for the original equation.



For instance, instead of writing the three-dimensional Navier-Stokes energy equation using one single operator~$\Lo$:
\begin{equation}
 \label{eq:ns2d_04}
\begin{split}
\Lo= \Diff{\rho e_t}{t}&+\nabla \cdot (\rho\bv{u}e_t) +\nabla\cdot \bv{q} +  \nabla\cdot(p  \bv{u})  - \nabla \cdot (\bv{\tau} \cdot \bv{u}),
%\Diff{\rho e_t}{t}& + \nabla \cdot (\rho \bv{u} H)+\nabla\cdot \bv{q} - \nabla \cdot (\bv{\tau u})
\end{split}
\end{equation}
to then be used in the MMS, let Equation (\ref{eq:ns2d_04}) be written with five operators, according to their physical meaning:
\begin{equation}
 \begin{split}\label{sub01}
  \Lo_{\text{time}}&=\Diff{\rho e_t}{t} ,\\
  \Lo_{\convection}&=\nabla \cdot (\rho\bv{u}e_t),\\
  \Lo_{\conduction}&=\nabla\cdot \bv{q},\\
  \Lo_{\pressure}&= \nabla\cdot(p  \bv{u}),\\
  \Lo_{\viscous}&=- \nabla \cdot (\bv{\tau} \cdot \bv{u}),
 \end{split}
\end{equation}
where $\Lo_{\text{time}}$ denotes the rate of accumulation of inertial and kinetic energy, $\Lo_{\convection}$ is the net rate of internal and kinetic energy increase by convection, $\Lo_{\conduction}$ is the net rate of heat addition due to heat conduction, $\Lo_{\pressure}$ is the rate of work done on the fluid by external body forces, and $\Lo_{\viscous}$ is the rate of work done on the fluid by viscous forces. Naturally:
$$\Lo=\Lo_{\text{time}}+\Lo_{\convection}+\Lo_{\conduction}+\Lo_{\pressure}+\Lo_{\viscous}.$$

After the application of each sub-operator defined in (\ref{sub01}), the corresponding sub-source terms are also simplified, factorized and sorted. Then, the final factorized version is checked against the original one, in order to assure that no human error has been introduced.

An advantage of this strategy is the possibility of inclusion and/or removal of other physical effects without the need of re-doing previous manipulations. For instance, in order to simplify this model by considering constant viscosity, changes should be made only in operator  $\Lo_{\viscous}$, in the total energy and momentum equations; the other terms on such equations, the continuity equation and the equation for the transport of the scalar all remain the same. 

This strategy, named ``Hierarchic MMS'', results in less time spent in the manipulations, decreases the computational effort and occasional software crashes, and also increases the flexibility in the code verification procedure.

\appendix


\section{List of model / manufactured solution parameters}\label{Appendix:01}

There are a variety of parameters present in the flow described by Navier-Stokes equations with the passive transport of a generic scalar and the Sutherland viscosity model, due to both fluid properties and the constants arising from the chosen manufactured solutions.



Table \ref{table_aux_var} shows the constants arising from fluid properties and their representation in the C code and Table \ref{table_aux_var02} shows the constants present in the manufactured solutions.


\begin{table}[p]
\caption{Relations between fluid properties in the model documentation and in the C code.}
\centering
\begin{tabular}{l c c c}
\hline\hline
     Variable    &  Description & Equation &Representation in C  \\ [0.25ex]
\hline 
$B_\mu$   	& Sutherland temperature			& (\ref{eq:Sutherland01})  & \texttt{B\_mu}	 \vspace{2pt} \\
$T_{ref}$ 	& reference temperature				& (\ref{eq:Sutherland01}), (\ref{eq:Sutherland02})	& \texttt{T\_ref}		\vspace{2pt} \\
$\mu_{ref}$	& reference viscosity				& (\ref{eq:Sutherland02}) & \texttt{mu\_ref} \vspace{2pt} \\
$\gamma$	& ratio of specific heats			& (\ref{eq:k})			  & \texttt{Gamma}	 \vspace{2pt} \\
Pr			& Prandtl number					& (\ref{eq:k})			  & \texttt{Pr}		 \vspace{2pt} \\
R			& gas constant						& (\ref{eq:ns_05})		  & \texttt{R}		 \vspace{2pt} \\
$\kappa$    & thermal conductivity coefficient  & (\ref{eq:k})            & \texttt{kappa}   \vspace{2pt} \\
\hline
\end{tabular}
\label{table_aux_var}
\end{table}

For air, the Sutherland's law coefficients are: $B_\mu   = 110.4 \, [K], \, T_{ref} = 273.15 \, [K],  \, \mu_{ref} = 1.716\times 10^{-5}\, [kg/ms]$ and, therefore, $A_\mu=1.458\times 10^{-6} [kg /ms\sqrt{K}]$. Additionally, $\gamma  = 1.4 ,\, R = 287 \, [J/kg K],\, Pr  = 0.7$. 
\begin{table}[hptb]
\caption{Constants in the manufactured solutions and their representation in C codes.}
\centering
\begin{tabular}{l c | c c}
\hline\hline
 Constant     & Representation in C &  Constant     & Representation in C \\ [0.25ex]
\hline 
$L$			  & L	   				& $ a_{ux}$ 	& \texttt{a\_ux}  \\    
$ L_{t}$ 	  & Lt	   				& $ a_{uy}$ 	& \texttt{a\_uy}  \\
$ a_{\rho x}$ & \texttt{a\_rhox}	& $ a_{ut}$ 	& \texttt{a\_ut}  \\
$ a_{\rho y}$ & \texttt{a\_rhoy}	& $ u_{0}$ 	    & \texttt{u\_0}   \\ 
$ \rho_{0}$   & \texttt{rho\_0}		& $ u_{x}$ 	    & \texttt{u\_x}   \\ 
$ \rho_{x}$   & \texttt{rho\_x}   	& $ u_{y}$ 	    & \texttt{u\_y}   \\ 
$ \rho_{y}$   & \texttt{rho\_y}   	& $ u_{t}$ 	    & \texttt{u\_t}   \\
$ \rho_{t}$   & \texttt{rho\_t}     & $ a_{vx}$ 	& \texttt{a\_vx}  \\
$ a_{px}$ 	  & \texttt{a\_px}  	& $ a_{vy}$ 	& \texttt{a\_vy}  \\
$ a_{py}$ 	  &	\texttt{a\_py}   	& $ a_{vt}$ 	& \texttt{a\_vt}  \\  
$ a_{pt}$ 	  & \texttt{a\_pt}    	& $ v_{0}$ 	    & \texttt{v\_0}   \\ 
$ p_{0}$ 	  & \texttt{p\_0 }  	& $ v_{x}$ 	    & \texttt{v\_x}   \\ 
$ p_{x}$ 	  & \texttt{p\_x }    	& $ v_{y}$		& \texttt{v\_y}   \\ 
$ p_{y}$      &	\texttt{p\_y }  	& $ v_{t}$		& \texttt{v\_t}   \\ 
$ p_{t}$      & \texttt{p\_t}   	& $\pi$         & \texttt{PI}     \\
\hline
\end{tabular}
\label{table_aux_var02}
\end{table}




\section{C Files}
The $C$ files for both source terms and gradients of the  manufactured solutions are:
\begin{itemize}
 \item \texttt{NavierStokes\_2d\_transient\_Sutherland\_e\_code.C} \vspace{-6pt}
 \item \texttt{NavierStokes\_2d\_transient\_Sutherland\_rho\_code.C}\vspace{-6pt}
 \item \texttt{NavierStokes\_2d\_transient\_Sutherland\_u\_code.C}\vspace{-6pt}
 \item \texttt{NavierStokes\_2d\_transient\_Sutherland\_v\_code.C}\vspace{-6pt}
 \item \texttt{NavierStokes\_2d\_transient\_Sutherland\_manuf\_solutions\_grad\_code.C}
\end{itemize}


\lstinputlisting[caption=File \texttt{NavierStokes\_2d\_transient\_Sutherland\_rho\_code.C}, label=code:rho]{../C_code/NavierStokes_2d_transient_Sutherland_rho_code.C}

\lstinputlisting[caption=File \texttt{NavierStokes\_2d\_transient\_Sutherland\_u\_code.C}, label=code:u]{../C_code/NavierStokes_2d_transient_Sutherland_u_code.C}

\lstinputlisting[caption=File \texttt{NavierStokes\_2d\_transient\_Sutherland\_v\_code.C}, label=code:v]{../C_code/NavierStokes_2d_transient_Sutherland_v_code.C}

 \lstinputlisting[caption=File \texttt{NavierStokes\_2d\_transient\_Sutherland\_e\_code.C}, label=code:e]{../C_code/NavierStokes_2d_transient_Sutherland_e_code.C}

 \lstinputlisting[caption=File \texttt{NavierStokes\_2d\_transient\_Sutherland\_manuf\_solutions\_grad\_code.C}, label=code:grad]{../C_code/NavierStokes_2d_transient_Sutherland_manuf_solutions_grad_code.C}
%---------------------------------------------------------------------------------------------------------
\bibliographystyle{chicago} 
%\bibliography{../../MMS_bib}
\bibliography{/home/kemelli/MMS_maple_workplace/MMS_bib}
\end{document}

